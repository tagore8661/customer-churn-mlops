# Customer Churn MLOps - Kubernetes Service Account Configuration
# This file creates the necessary namespace, secrets, and service account for KServe model deployment

---
# Create a dedicated namespace for the churn prediction service
apiVersion: v1
kind: Namespace
metadata:
  name: churn
  labels:
    app: churn-prediction

---

# AWS S3 credentials secret for model storage access
# KServe uses this secret to download the model from S3 bucket
apiVersion: v1
kind: Secret
metadata:
  name: s3-secret
  namespace: churn
  annotations:
    # KServe-specific annotations for S3 configuration
    serving.kserve.io/s3-endpoint: s3.amazonaws.com
    serving.kserve.io/s3-usehttps: "1"  # Use HTTPS for secure connection
    serving.kserve.io/s3-region: us-east-1
type: Opaque
stringData:
  # AWS credentials - replace with actual values in production
  AWS_ACCESS_KEY_ID: <ACCESS_KEY_ID>
  AWS_SECRET_ACCESS_KEY: <SECRET_ACCESS_KEY>

---

# Service account with S3 access permissions
# This service account will be used by KServe InferenceService
apiVersion: v1
kind: ServiceAccount
metadata:
  name: sa-s3-access
  namespace: churn
  labels:
    app: churn-prediction
secrets:
- name: s3-secret  # Attach the S3 secret to this service account